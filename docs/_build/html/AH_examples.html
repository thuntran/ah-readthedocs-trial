
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Example of Creating Aligned Hierarchies for a Mazurka Score &#8212; mirah  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Search" href="search_doc.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="search_doc.html" title="Search"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mirah  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example of Creating Aligned Hierarchies for a Mazurka Score</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Example-of-Creating-Aligned-Hierarchies-for-a-Mazurka-Score">
<h1>Example of Creating Aligned Hierarchies for a Mazurka Score<a class="headerlink" href="#Example-of-Creating-Aligned-Hierarchies-for-a-Mazurka-Score" title="Permalink to this headline">¶</a></h1>
<p>In this example, we will walk through the elements of the <code class="docutils literal notranslate"><span class="pre">mirah</span></code> package that pertain to the creation of aligned hierarchies for a music-based data stream (eg. a song).</p>
<p>Beginning with features (such as MFCCs and chroma features) for each timestep in your music based data stream, there are several steps to this process:</p>
<ol class="arabic simple" start="0">
<li><p>Create the self-dissimilarity matrix (SDM).</p></li>
<li><p>Highlight pairs of timesteps that are close enough to be considered as repetitions of each other. (In other words, threshold the SDM)</p></li>
<li><p>Find pairs of structure repetitions (represented as diagonals within the thresholded SDM).</p></li>
<li><p>Find any pairs of structure repetitions not found in step 2, and group the structure repetitions.</p></li>
<li><p>Remove any repeated structures that have overlapped instance.</p></li>
<li><p>Distill the collection of repeated structures into the <em>essential structure components</em> , i.e. the smallest meaningful repetitions on which all larger repeats are constructed. Each timestep will be contained in no more than one essential structure component</p></li>
</ol>
<p><em>Note</em> : This python notebook borrows heavily from <code class="docutils literal notranslate"><span class="pre">example.py</span></code> found in this directory.</p>
<p>An example function pipeline is shown below to illustrate the function calls of each step. For an in depth look at each function, check the corresponsing jupyter notebooks for each module.</p>
<ul class="simple">
<li><p>Yellow: utilities</p></li>
<li><p>Purple: search</p></li>
<li><p>Green: transform</p></li>
<li><p>Red: assemble</p></li>
</ul>
<img alt="alt text" src="_images/function_pipeline.png" />
<p>We begin by importing the necessary packages:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NumPy and SciPy are required for mathematical operations</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Pandas is used to import the csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># utilities imports needed functions</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">))</span>
<span class="n">relative_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relative_path</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mirah.utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mirah.search</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mirah.transform</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mirah.assemble</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Matplotlib is used to display outputs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<section id="Step-0:-Creating-the-SDM">
<h2>Step 0: Creating the SDM<a class="headerlink" href="#Step-0:-Creating-the-SDM" title="Permalink to this headline">¶</a></h2>
<p>In this phase, there are a few crucial details, namely importing the data file that we would like to unearth hierarchical structural information for and determining the appropriate dissimilarity measure to use. If you already have (symmetrical) matrix representations for your data stream, then you may find it more appropriate to load your matrix and then skip ahead to Step 1 or Step 2.</p>
<p>This step assumes that your music-based data stream (ie. a recording or score) has already had your preferred features extracted (like chroma or MFCCs) and is arranged into columns such that each column represents a time step (or beat). We refer to this as a <em>feature vector matrix</em> as each feature vector is laid out as column within one cohesive matrix.</p>
<section id="Importing-Data-for-structure-analysis">
<h3>Importing Data for structure analysis<a class="headerlink" href="#Importing-Data-for-structure-analysis" title="Permalink to this headline">¶</a></h3>
<p>Here we import the file in a familiar manner:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import csv</span>
<span class="n">file_in</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">),</span> <span class="s2">&quot;../input.csv&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">fv_mat</span> <span class="o">=</span> <span class="n">file_in</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of feature vectors per shingle</span>
<span class="n">num_fv_per_shingle</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Create the self-dissimilarity matrix</span>
<span class="n">self_dissim_mat</span> <span class="o">=</span> <span class="n">create_sdm</span><span class="p">(</span><span class="n">fv_mat</span><span class="p">,</span> <span class="n">num_fv_per_shingle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self_dissim_mat:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">self_dissim_mat</span><span class="p">)</span>

<span class="c1"># Produce a visualization</span>
<span class="n">SDM</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">self_dissim_mat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Self-Dissimilarity Matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
self_dissim_mat:
 [[0.         0.28813862 0.51259504 ... 0.7575822  0.81139542 0.81133335]
 [0.28813862 0.         0.26375769 ... 0.56254648 0.89303436 0.85019882]
 [0.51259504 0.26375769 0.         ... 0.42258308 0.64702668 0.8048716 ]
 ...
 [0.7575822  0.56254648 0.42258308 ... 0.         0.38009303 1.        ]
 [0.81139542 0.89303436 0.64702668 ... 0.38009303 0.         0.81572885]
 [0.81133335 0.85019882 0.8048716  ... 1.         0.81572885 0.        ]]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_5_1.png" src="_images/AH_examples_5_1.png" />
</div>
</div>
</section>
<section id="Creating-the-SDM">
<h3>Creating the SDM<a class="headerlink" href="#Creating-the-SDM" title="Permalink to this headline">¶</a></h3>
<p>In just one line, we define the self-dissimiliarity matrix. This function <code class="docutils literal notranslate"><span class="pre">create_sdm</span></code>, uses feature vectors to create an audio shingle for each time step and represents these shingles as vectors by stacking the relevant feature vectors on top of each other. Then, the cosine distance is found between these shingles.</p>
</section>
</section>
<section id="Step-1:-Thresholding-the-SDM">
<h2>Step 1: Thresholding the SDM<a class="headerlink" href="#Step-1:-Thresholding-the-SDM" title="Permalink to this headline">¶</a></h2>
<p>In this step, the self-dissimilarity matrix is threshholded to produce a binary matrix of the same dimensions. This matrix is used to identify repeated structures, which are represented by diagonals of the same length.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">song_length</span> <span class="o">=</span> <span class="n">self_dissim_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># Threshold the SDM to produce a binary matrix</span>
<span class="n">thresh_dist_mat</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_dissim_mat</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;thresh_dist_mat:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">thresh_dist_mat</span><span class="p">)</span>

<span class="c1"># Produce a visualization</span>
<span class="n">SDM</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">thresh_dist_mat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Thresholded Matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
thresh_dist_mat:
 [[ True False False ... False False False]
 [False  True False ... False False False]
 [False False  True ... False False False]
 ...
 [False False False ...  True False False]
 [False False False ... False  True False]
 [False False False ... False False  True]]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_8_1.png" src="_images/AH_examples_8_1.png" />
</div>
</div>
</section>
<section id="Step-2:-Find-the-diagonals-present-and-store-all-found-pairs-of-repeats-in-a-list">
<h2>Step 2: Find the diagonals present and store all found pairs of repeats in a list<a class="headerlink" href="#Step-2:-Find-the-diagonals-present-and-store-all-found-pairs-of-repeats-in-a-list" title="Permalink to this headline">¶</a></h2>
<p>The diagonals in the thresholded matrix are found and recorded in an array of repeats. <code class="docutils literal notranslate"><span class="pre">find_initial_repeats</span></code> does this by looking for the largest repeated structures in <em>thresh_mat</em>, which are illustrated in the above Thresholded Matrix diagram. Once all repeated structures are found, which are represented as diagonals present in <em>thresh_mat</em>, they are stored with their start/end indices and lengths in a list. As each diagonal is found, it is removed to avoid identifying repeated
sub-structures.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">all_lst</span> <span class="o">=</span> <span class="n">find_initial_repeats</span><span class="p">(</span><span class="n">thresh_dist_mat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">song_length</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;all_lst:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">all_lst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
all_lst:
 [[  8   8  14  14   1]
 [  8   8  62  62   1]
 [  8   8 110 110   1]
 [ 14  14  56  56   1]
 [ 14  14 104 104   1]
 [ 56  56  62  62   1]
 [ 56  56 110 110   1]
 [ 62  62 104 104   1]
 [104 104 110 110   1]
 [  4  14  52  62  11]
 [  4  14 100 110  11]
 [ 26  71  74 119  46]
 [  1 119   1 119 119]]
</pre></div></div>
</div>
</section>
<section id="Step-3:-Find-any-diagonals-in-T-not-found-in-step-2-contained-in-larger-diagonals-in-T,-then-group-pairs-of-repeats">
<h2>Step 3: Find any diagonals in T not found in step 2 contained in larger diagonals in T, then group pairs of repeats<a class="headerlink" href="#Step-3:-Find-any-diagonals-in-T-not-found-in-step-2-contained-in-larger-diagonals-in-T,-then-group-pairs-of-repeats" title="Permalink to this headline">¶</a></h2>
<p>Any diagonals that are contained in larger diagonals are found and added to the array of repeats. All possible repeat lengths are looped over in <em>all_lst</em>, and larger repeats containing smaller repeats are broken up into up to 3 sections each, the part before the overlap, the overlap, and the part after the overlap. The figure below illustrates how 2 overlapping repeats are broken up into 3 sections. With this, a complete list of overlaps is created.</p>
<img alt="alt text" src="_images/find_complete_list_visualization.png" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">complete_lst</span> <span class="o">=</span> <span class="n">find_complete_list</span><span class="p">(</span><span class="n">all_lst</span><span class="p">,</span> <span class="n">song_length</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;complete_lst:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">complete_lst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
complete_lst:
 [[  8   8  14  14   1   1]
 [  8   8  56  56   1   1]
 [  8   8  62  62   1   1]
 [  8   8 104 104   1   1]
 [  8   8 110 110   1   1]
 [ 14  14  56  56   1   1]
 [ 14  14  62  62   1   1]
 [ 14  14 104 104   1   1]
 [ 14  14 110 110   1   1]
 [ 56  56  62  62   1   1]
 [ 56  56 104 104   1   1]
 [ 56  56 110 110   1   1]
 [ 62  62 104 104   1   1]
 [ 62  62 110 110   1   1]
 [104 104 110 110   1   1]
 [  4   7  52  55   4   1]
 [  4   7 100 103   4   1]
 [  9  14  57  62   6   1]
 [  9  14 105 110   6   1]
 [ 63  71 111 119   9   1]
 [  4  13  52  61  10   1]
 [  4  13 100 109  10   1]
 [  4  14  52  62  11   1]
 [  4  14 100 110  11   1]
 [ 52  62 100 110  11   1]
 [ 57  71 105 119  15   1]
 [ 26  51  74  99  26   1]
 [ 26  55  74 103  30   1]
 [ 26  61  74 109  36   1]
 [ 26  71  74 119  46   1]]
</pre></div></div>
</div>
</section>
<section id="Step-4:-Remove-any-repeated-structure-that-have-at-least-two-repeats-that-overlap">
<h2>Step 4: Remove any repeated structure that have at least two repeats that overlap<a class="headerlink" href="#Step-4:-Remove-any-repeated-structure-that-have-at-least-two-repeats-that-overlap" title="Permalink to this headline">¶</a></h2>
<p>In this step, repeated structures with the same annotation and length are removed if they are overlapping.</p>
<p>This is done by looping over all possible repeat lengths, finding all the groups of repeats of the same length. For each of those groups, <code class="docutils literal notranslate"><span class="pre">remove_overlaps</span></code> determines whether there exists any pair of repeats that overlaps in time. If a pair like that exists, all the overlapping repeats are removed.</p>
<p>Along with a list of all the repeats with no overlaps, this step also forms a matrix, a list of the associated lengths of the repeats in the matrix, the annotations of the repeats in the matrix, and a list of the overlaps. The matrix is a binary matrix that visualizes the repeats, representing the start of a repeat with a 1. This matrix, in combination with the list of the lengths of the repeats, can be used to visualize the repeats.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">output_tuple</span> <span class="o">=</span> <span class="n">remove_overlaps</span><span class="p">(</span><span class="n">complete_lst</span><span class="p">,</span> <span class="n">song_length</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;List with no overlaps:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matrix with no overlaps:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lengths of the repeats in the matrix:&#39;</span><span class="p">,</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Annotations of the repeats in the matrix:&#39;</span><span class="p">,</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;List of overlaps:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
List with no overlaps:
 [[  8   8  14  14   1   1]
 [  8   8  56  56   1   1]
 [  8   8  62  62   1   1]
 [  8   8 104 104   1   1]
 [  8   8 110 110   1   1]
 [ 14  14  56  56   1   1]
 [ 14  14  62  62   1   1]
 [ 14  14 104 104   1   1]
 [ 14  14 110 110   1   1]
 [ 56  56  62  62   1   1]
 [ 56  56 104 104   1   1]
 [ 56  56 110 110   1   1]
 [ 62  62 104 104   1   1]
 [ 62  62 110 110   1   1]
 [104 104 110 110   1   1]
 [  4   7  52  55   4   1]
 [  4   7 100 103   4   1]
 [  9  14  57  62   6   1]
 [  9  14 105 110   6   1]
 [ 63  71 111 119   9   1]
 [  4  13  52  61  10   1]
 [  4  13 100 109  10   1]
 [  4  14  52  62  11   1]
 [  4  14 100 110  11   1]
 [ 52  62 100 110  11   1]
 [ 57  71 105 119  15   1]
 [ 26  51  74  99  26   1]
 [ 26  55  74 103  30   1]
 [ 26  61  74 109  36   1]
 [ 26  71  74 119  46   1]]
Matrix with no overlaps:
 [[0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]
 ...
 [0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]
 [0 0 0 ... 0 0 0]]
Lengths of the repeats in the matrix: [ 1  4  6  9 10 11 15 26 30 36 46]
Annotations of the repeats in the matrix: [1 1 1 1 1 1 1 1 1 1 1]
List of overlaps:
 []
</pre></div></div>
</div>
</section>
<section id="Step-5:-Find-the-essential-structure-components-of-the-song-and-build-the-aligned-hierarchies">
<h2>Step 5: Find the essential structure components of the song and build the aligned hierarchies<a class="headerlink" href="#Step-5:-Find-the-essential-structure-components-of-the-song-and-build-the-aligned-hierarchies" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">hierarchical_structure</span></code> first finds the essential structure components with <code class="docutils literal notranslate"><span class="pre">breakup_overlaps_by_intersect</span></code>. After this, modified versions of steps 2-4 take place to create the full hierarchical structure.</p>
<p>After creating the essential strucutre components, a diagonal matrix of the starting indices of the essential structure components is made, from which information about the combinations of essential structures is extracted following steps similar to those of 2 through 4. From the diagonal matrix, all diagonals are extracted, starting with the longest one, but are not removed. This way, all possible combinations of essential structure components are found. Then, all these combinations are grouped
and checked for overlapping repeated combinations. The final product is then restructured to show all the widths and annotations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">mat_no_overlaps</span><span class="p">,</span> <span class="n">key_no_overlaps</span><span class="p">)</span> <span class="o">=</span> <span class="n">output_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># Distill non-overlapping repeats into essential structure components and</span>
<span class="c1"># use them to build the hierarchical representation</span>
<span class="n">output_tuple</span> <span class="o">=</span> <span class="n">hierarchical_structure</span><span class="p">(</span><span class="n">mat_no_overlaps</span><span class="p">,</span> <span class="n">key_no_overlaps</span><span class="p">,</span> <span class="n">song_length</span><span class="p">,</span> <span class="n">vis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_16_0.png" src="_images/AH_examples_16_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_16_1.png" src="_images/AH_examples_16_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_16_2.png" src="_images/AH_examples_16_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_16_3.png" src="_images/AH_examples_16_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/AH_examples_16_4.png" src="_images/AH_examples_16_4.png" />
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example of Creating Aligned Hierarchies for a Mazurka Score</a><ul>
<li><a class="reference internal" href="#Step-0:-Creating-the-SDM">Step 0: Creating the SDM</a><ul>
<li><a class="reference internal" href="#Importing-Data-for-structure-analysis">Importing Data for structure analysis</a></li>
<li><a class="reference internal" href="#Creating-the-SDM">Creating the SDM</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Step-1:-Thresholding-the-SDM">Step 1: Thresholding the SDM</a></li>
<li><a class="reference internal" href="#Step-2:-Find-the-diagonals-present-and-store-all-found-pairs-of-repeats-in-a-list">Step 2: Find the diagonals present and store all found pairs of repeats in a list</a></li>
<li><a class="reference internal" href="#Step-3:-Find-any-diagonals-in-T-not-found-in-step-2-contained-in-larger-diagonals-in-T,-then-group-pairs-of-repeats">Step 3: Find any diagonals in T not found in step 2 contained in larger diagonals in T, then group pairs of repeats</a></li>
<li><a class="reference internal" href="#Step-4:-Remove-any-repeated-structure-that-have-at-least-two-repeats-that-overlap">Step 4: Remove any repeated structure that have at least two repeats that overlap</a></li>
<li><a class="reference internal" href="#Step-5:-Find-the-essential-structure-components-of-the-song-and-build-the-aligned-hierarchies">Step 5: Find the essential structure components of the song and build the aligned hierarchies</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="search_doc.html"
                        title="previous chapter">Search</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/AH_examples.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="search_doc.html" title="Search"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mirah  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example of Creating Aligned Hierarchies for a Mazurka Score</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Katherine M Kinnaird, Eleanor Donaher, Lizette Carpenter, Jordan Moody, Denise Nava, Sasha Yeutseyeva, Chenhui Jia, Marium Tapal, Betty Wang, Thu Tran, Zoie Zhao.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>